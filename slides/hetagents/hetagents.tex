\documentclass[11pt,xcolor={dvipsnames},aspectratio=159,hyperref={pdftex,pdfpagemode=UseNone,hidelinks,pdfdisplaydoctitle=true},usepdftitle=false]{beamer}
\usepackage{presentation}[aspectratio=169]
\usepackage{math}
\usepackage{mathtools}
\usepackage{mleftright}
\usepackage{algorithm}% http://ctan.org/pkg/algorithms
\usepackage{algpseudocode}% http://ctan.org/pkg/algorithmicx
\hypersetup{
    colorlinks=magenta,
    linkcolor=magenta,
    filecolor=magenta,      
    urlcolor=magenta,
    }
% Enter title of presentation PDF:
\hypersetup{pdftitle={Heterogenous Agent Models}}


\begin{document}
% Enter presentation title:
\title{Heterogenous Agent Models}
\subtitle{Quantitative Economics 2024}
% Enter presentation information:


% Enter presentation authors:
\author{Piotr Å»och}%
% Enter presentation location and date (optional; comment line if not needed):
\frame{\titlepage}

% Fill out content of presentation:

\begin{frame}{Motivation}   
   
    \begin{itemize}
        \item We introduce a class of models with heterogeneous agents.
        \item We focus on models with household heterogeneity and incomplete markets: Aiyagari-Bewley-Hugget-Imrohoroglu models.
        \begin{itemize}
            \item Infinitely lived households face idiosyncratic shocks.
            \item Markets are \al{incomplete} -- households cannot trade all assets they would like to trade.
        \end{itemize}
        \item We will find \alb{general equilibrium} of these models.
    \end{itemize}
    \end{frame}


\begin{frame}{Agents}   
   
    \begin{itemize}
        \item In all these models there is a continuum of agents/households indexed by $i\in\bs{0,1}$.
        \item Agents are infinitely lived, have a standard period utility function $u\of{c}$, where $c$ is consumption, discount future at $\b\in\bp{0,1}$.
        \item Labor endowment (productivity) is stochastic and follows a stationary Markov process (same process for all $i$), with a finite set of states $\text{Z}$ and transition matrix $P$.
        \item Agents consume and trade a single asset $a$ that pays (net) return $r$. Wage per unit of labor is $w$.
        \item Agents face a borrowing constraint, $a\geq -\phi$.
    \end{itemize}
    \end{frame}

    \begin{frame}{Agents}   
   
        \begin{itemize}
            \item State variables: beginning of period assets $a$ and labor endowment $z$.
            \item Recursive formulation of a problem of an agent with assets $a$ and labor endowment $z$ is 
            \begin{align*}
                V\of{a,z} &= \max_{c, a^\prime} \bc{u\of{c} + \b \sum_{z^\prime \in \text{Z}} P\of{z,z^\prime} V\of{a^\prime,z^\prime} } \\
                \text{subject to  } & c + a^\prime = z w + \bp{1+r} a, \\
                & a^\prime \geq -\phi.
            \end{align*}
            \item The solution consists of the value function $V\of{a,z}$ and the policy functions $a^\prime\of{a,z}, c\of{a,z}$. 
            \item Note: everything (e.g. $V$) depends on $\bp{r,w}$, we supress it in notation.
        \end{itemize}
        \end{frame}

\begin{frame}{Distribution}   
    \begin{itemize}
        \item Suppose that there a finite grid of asset levels $\bp{a_1,\dots,a_N}$ and define the unconditional distribution $\lambda_t\of{a,z} \coloneq  \P\of{a_t=a,z_t=z}$. 
       \item Given the policy function $a^\prime\of{a,z}$ and $P$ we have \begin{align*}
           \lambda_{t+1}\of{a^\prime,z^\prime} = \sum_{a,z} \lambda_t\of{a,z} \cdot P\of{z,z^\prime} \cdot \Ic\of{a^\prime = a^\prime\of{a,z}} , \end{align*}
   where $\Ic$ is the indicator function.
   \item What if assets are not restricted to a grid? Similar logic, but a more messy formula (+ measure theory).
   \item We will need to discretize the state space and action space anyway.
\end{itemize}
   \end{frame}
   

   \begin{frame}{Aggregation}   
    \begin{itemize}
        \item Given a distribution $\lambda_t$ and policy functions $a^\prime\of{a,z}$ and $c\of{a,z}$ we can calculate aggregate variables.
        \item We have asset demand and consumption\begin{align*}
            A^\prime_t &= \int  a^\prime\of{a,z} \cdot d\lambda_t\of{a,z}, \\
            C_t &= \int  c\of{a,z} \cdot d\lambda_t\of{a,z}.
        \end{align*}
        \item I switched notation again, for a finite grid we have $A^\prime_t = \sum_{a,z} a^\prime\of{a,z} \cdot \lambda_t\of{a,z}$ and $C_t = \sum_{a,z} c\of{a,z} \cdot \lambda_t\of{a,z}$.
\end{itemize}
   \end{frame}


   \begin{frame}{The rest of the economy}   
    \begin{itemize}
        \item How are $r$ and $w$ determined? 
        \item What/who supplies goods?
        \item What/who supplies assets?
        \item We will start with the \alb{Hugget} model: 
        \begin{itemize}
            \item Endowment economy: $w$ exogenous, $wz$ is the amount of goods received by an agent.
            \item Nothing/nobody else in the economy. Supply of assets is zero. 
        \end{itemize}
        \item Market clearning conditions: \begin{itemize}
        \item \al{Goods market:} $C_t = w\int z_i di.$
        \item \al{Asset market:} $A^\prime_t = 0$.
\end{itemize}
\end{itemize}
   \end{frame}

    \begin{frame}{Hugget model}
        \begin{itemize}
            \item Assets are loans from/to agents.
            \item Asset market clears if the total amount of loans (negative $a$) is equal to the total amount of savings (positive $a$).
            \item We will be looking for a \alb{stationary equilibrium}: the distribution of agents and prices (here only $r$) are constant over time.
            \item This was already anticipated by how we wrote the Bellman equation -- no time subscripts anywhere.
        \end{itemize}
        \end{frame}

    \begin{frame}{RCE in Hugget model}
        \begin{definition}[Stationary recursive competitive equilibrium (RCE)]

            A \alb{stationary recursive competitive equilibrium} is a rate of return $r$, a value function $V\of{a,z}$, policy functions $a^\prime\of{a,z}$ and $c\of{a,z}$, and a distribution $\lambda\of{a,z}$ such that \begin{enumerate}
                \item Given $r$, the value function $V\of{a,z}$ satisfies the Bellman equation, and associated policy functions $a^\prime\of{a,z}$, $c\of{a,z}$, solve the agent's maximization problem;
                \item The probability distribution $\lambda\of{a,z}$ is the stationary distribution of the Markov process $\bp{a_t,z_t}$ induced by $P$ and $a^\prime\of{a,z}$;
                \item Markets clears: \begin{align*}
                    \int  a^\prime\of{a,z} \cdot d\lambda\of{a,z} =0, \quad
            \int  c\of{a,z} \cdot d\lambda\of{a,z} = w\int z d\lambda\of{a,z}. \end{align*}
            \end{enumerate}
            \end{definition}
        \end{frame}

\begin{frame}{Comments}   
    \begin{itemize}
        \item We now need to find $r$ such that aggregate asset demand resulting from optimal decisions of agents is zero.
        \item Alternatively, we can find $r$ such that the goods market clears. 
        \item Recall: the Walras law says that if there are $N$ markets and $N-1$ clear, the $N$-th market also clears.
    \end{itemize}
    \end{frame}

\begin{frame}{Comments}   
        \begin{itemize}
            \item The usual procedure is: 
            \begin{enumerate}
            \item Guess $r$.
            \item Solve the Bellman equation for $V\of{a,z}$ and $a^\prime\of{a,z}$.
            \item Find the stationary distribution $\lambda\of{a,z}$.
            \item Calculate aggregate asset demand $A^\prime$.
            \item If $A^\prime>0$, decrease $r$, if $A^\prime<0$, increase $r$.
            \end{enumerate}
            \item This combines several things: 
            \begin{itemize}
            \item solving the Bellman equation
            \item finding the stationary distribution
            \item (new) finding the equilibrium price $r$.
            \end{itemize}
        \end{itemize}
        \end{frame}


\begin{frame}{Computation}   
    \begin{itemize}
        \item When we solve the model on a computer we discretize the state space and have a finite grid of points for assets: $\bp{a_1,\dots,a_N}$ and for productivity $\bp{z_1,\dots,z_M}$.
        \item We usually want to allow maximizers of the RHS of the Bellman equation to not necessarily belong to the grid.
        \item We cannot use the formula \begin{align*}
            \lambda\of{a^\prime,z^\prime} = \sum_{a,z} \lambda\of{a,z} \cdot P\of{z,z^\prime} \cdot \Ic\of{a^\prime = a^\prime\of{a,z}} , \end{align*}
            because $a^\prime\of{a,z}$ might not belong to the grid.
            \item How to find the stationary distribution $\lambda\of{a,z}$ in this case?
        \end{itemize}
    \end{frame}

\begin{frame}{Computation}   
    \begin{itemize}
        \item When we solve the model on a computer we discretize the state space and have a finite grid of points for assets: $\bp{a_1,\dots,a_N}$ and for productivity $\bp{z_1,\dots,z_M}$.
        \item We usually want to allow maximizers of the RHS of the Bellman equation to not necessarily belong to the grid.
        \item We cannot use the formula \begin{align*}
            \lambda\of{a^\prime,z^\prime} = \sum_{a,z} \lambda\of{a,z} \cdot P\of{z,z^\prime} \cdot \Ic\of{a^\prime = a^\prime\of{a,z}} , \end{align*}
            because $a^\prime\of{a,z}$ might not belong to the grid.
            \item How to find the stationary distribution $\lambda\of{a,z}$ in this case?
        \end{itemize}
    \end{frame}

\begin{frame}{Young (2010)}  
    \begin{itemize}

        \item Let \begin{align*}
            q\of{a,z,a_n}=\Ic\of{a^\prime\of{a,z}\in\bs{a_{n-1},a_n}} \frac{a^\prime\of{a,z}-a_{n-1}}{a_n - a_{n-1}} +  \Ic\of{a^\prime\of{a,z}\in\bs{a_{n},a_{n+1}}}  \frac{a_{n+1} - a^\prime\of{a,z}}{a_{n+1} - a_{n}}
        \end{align*}  be the distribution of agents with assets $a_n$ and $a_{n+1}$.
        \item Then 
        \begin{align*}
            \lambda\of{a^\prime,z^\prime} = \sum_{a,z} \lambda\of{a,z} \cdot P\of{z,z^\prime} \cdot q\of{a,z,a^\prime}.
        \end{align*}

    \end{itemize}
    \end{frame}
    
    
\begin{frame}{Young (2010)}   
    \begin{itemize}
        \item This the same as saying that agent with assets $a$ and productivity $z$ will choose $a_n$ with probability $q\of{a,z,a_n,}$.
        \item Given there is a continuum of agents, this is the same as saying that the fraction $q\of{a,z,a_n,}$ of agents with assets $a$ and productivity $z$ will choose $a_n$. 
        \item This approach (due to Young (2010)) is useful because it makes aggregates unbiased.
    \end{itemize}
    \end{frame}
            
\begin{frame}{Aggregation and equilibrium}   
    \begin{itemize}
        \item Once we have the distribution $\lambda\of{a,z}$ we can calculate aggregates.
        \item For example: \begin{align*}
            A^\prime = \sum_{a,z} a^\prime\of{a,z} \cdot \lambda\of{a,z}.
        \end{align*}
        \item We can repeat the same procedure for various $r$ to find the equilibrium $r$, such that $A^\prime=0$.
        \item Better: write a function that takes $r$ as an input and returns $A^\prime$ as an output. Then use a root finding algorithm to find the equilibrium $r$.
    \end{itemize}
    \end{frame}

    \begin{frame}{Discussion}   
        \begin{itemize}
            \item Suppose we want to use a bracketing method to find the equilibrium $r$. 
            \item What are the appropriate bounds? Probably $r<-1$ does not make sense (nobody would save). The upper bound is more tricky.
            \item We can show that $r<\b^{-1}-1$ in equilibrium for the Hugget model (just see what happens if $r>\b^{-1}-1$).
        \end{itemize}
        \end{frame}

    \begin{frame}{Discussion}   
        \begin{itemize}
            \item Here you need to solve the Bellman equation for each $r$: possibly many times. 
            \item This can be costly - try to optimize the code. 
            \begin{itemize}
                \item Use HPI or OPI.
                \item Use EGM.
                \item Get the transition matrix for $\bp{a,z}$ and use it to find the stationary distribution (do not simulate anything!)
                \item \href{https://www.simonmongey.com/uploads/6/5/6/6/65665741/lecture_-_quantitative_macroeconomics_-_mongey.pdf}{Check out Simon Mongey's slides -- general notation but similar models.}
            \end{itemize}
        \end{itemize}
        \end{frame}

    \begin{frame}{Aiyagari model}
        \begin{itemize}
            \item In Aiyagari model there is a representative firm that hires labor and rents capital from households.
            \item The firm has a constant returns to scale production function $F\of{K,L}$, where $K$ is capital and $L$ is labor.
            \item The firm is competitive, so it takes $r$ and $w$ as given.
            \item The firm's problem is \begin{align*}
                \max_{K,L} F\of{K,L} - \bp{r+\d}K - wL.
            \end{align*}
        \end{itemize}
        \end{frame}

    \begin{frame}{Aiyagari model}
        \begin{itemize}
            \item Assets accumulated by households are capital and loans to other agents.
            \item Labor market clearing: $L = \int z \cdot d\lambda\of{a,z}$.
            \item Asset market clearing: $K = \int a \cdot d\lambda\of{a,z}$.
            \item Goods market clearing: $F\of{K,L} = C + \delta K$.
        \end{itemize}
        \end{frame}

        \begin{frame}{Aiyagari model}
        \begin{itemize}
            \item Notice that here we have \begin{align*}
                r = F_K\of{K,L} - \d, \quad w = F_L\of{K,L}.
            \end{align*}
            \item Because of the constant returns to scale \begin{align*}
                r = F_K\of{\frac{K}{L},1} - \d, \quad w = F_L\of{\frac{K}{L},1} .
            \end{align*}
            \item We can solve for $K/L$ as a function of $r$. This also allows us to solve for $w$ as a function of $r$.
            \item We know $L$ (it is exogenous) so we have $K\of{r}$ 
        \end{itemize}
        \end{frame}

    \begin{frame}{Aiyagari model}
        \begin{itemize}
            \item This suggests a following strategy:
            \begin{itemize}
            \item Guess $r$. Repeat all the steps from the Hugget model to find $A^\prime$.
            \item Calculate $K$.
            \item Check if $A^\prime = K$. If yes, we found the equilibrium $r$. If not, adjust (how?) $r$ and repeat.
            \end{itemize}
            \item We can simply find the root of $A^\prime\of{r} - K\of{r}=0$.
        \end{itemize}
        \end{frame}        

    \begin{frame}{Adding government}
        \begin{itemize}
            \item In many applications we are interested in the effects of some government policies.
            \item Example: how does an increase in taxation affect the wealth distribution?
            \item Example: how does an increase in government debt crowd out capital accumulation?
            \item We will now consider a simple extension of the Aiyagari model with government.
            \end{itemize}
        \end{frame}        

    \begin{frame}{Adding government}
        \begin{itemize}
            \item The intertemporal budget constraint of the government is \begin{align*}
                B_{t+1} = \bp{1+r}B_t + T_t - G_t.
            \end{align*}
            where $B_t$ is the government debt, $T_t$ is tax revenue net of transfers and $G_t$ is government purchases of goods.
            \item The government collects taxes on labor and capital income. Linear tax system with rates $\tau^w, \tau^r$. Tax revenue net of transfers is \begin{align*}
                T = \int \tau^w w z_i di + \int \tau^r r a_i - d.
            \end{align*}
            \end{itemize}
        \end{frame}       

    \begin{frame}{Adding government}
        \begin{itemize}
            \item In a stationary equilibrium the government budget constraint becomes \begin{align*}
                r B = T - G.
            \end{align*}
            \item Asset market clearing: $K + B = \int a \cdot d\lambda\of{a,z}$.
            \item Goods market clearing: $F\of{K,L} = C + \d K + G$.
            \item Key difference: assets available in the economy are $K+B$, not just $K$.
            \end{itemize}
        \end{frame}  

    \begin{frame}{Adding government}
        \begin{itemize}
            \item We also need to modify the household problem. 
            \item Recursive formulation of a problem of an agent with assets $a$ and labor endowment $z$ is 
            \begin{align*}
                V\of{a,z} &= \max_{c, a^\prime} \bc{u\of{c} + \b \sum_{z^\prime \in \text{Z}} P\of{z,z^\prime} V\of{a^\prime,z^\prime} } \\
                \text{subject to  } & c + a^\prime = \bp{1-\tau^w} z w + \bp{1+\bp{1-\tau^r}r} a + d, \\
                & a^\prime \geq -\phi.
            \end{align*}
            \item Note: dependence on government policies, we supress it in notation.
            \end{itemize}
        \end{frame}     
\end{document}